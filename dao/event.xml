<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="User">
    <select id="selectAll">
        SELECT OWNER_SEQ,
               EVENT_SEQ,
               EVENT_TITLE,
               EVENT_CONTENT,
               TO_CHAR(EVENT_START, 'YYYY-MM-DD'),
               TO_CHAR(EVENT_END, 'YYYY-MM-DD'),
               ATTACH_PATH,
               ATTACH_FILE,
               IN_DATE,
               IN_USER_ID,
               UP_DATE,
               UP_USER_ID
        FROM EVENT
        WHERE OWNER_SEQ = :V_OWNER_SEQ
           OR EXISTS(SELECT 1
                     FROM OWNER
                     WHERE OWNER_SEQ = :V_OWNER_SEQ
                       AND (ADMIN_YN = 'Y'
                         OR ADMIN_YN = 'y'))
        ORDER BY EVENT_SEQ DESC
    </select>

    <select id="select">
        SELECT OWNER_SEQ,
               EVENT_SEQ,
               EVENT_TITLE,
               EVENT_CONTENT,
               TO_CHAR(EVENT_START, 'YYYY-MM-DD'),
               TO_CHAR(EVENT_END, 'YYYY-MM-DD'),
               ATTACH_PATH,
               ATTACH_FILE,
               IN_DATE,
               IN_USER_ID,
               UP_DATE,
               UP_USER_ID
        FROM EVENT
        WHERE EVENT_SEQ = :V_EVENT_SEQ
          AND (OWNER_SEQ = :V_OWNER_SEQ
            OR EXISTS(SELECT 1
                      FROM OWNER
                      WHERE OWNER_SEQ = :V_OWNER_SEQ
                        AND (ADMIN_YN = 'Y'
                          OR ADMIN_YN = 'y')))
    </select>
    <update id="insert">
         INSERT INTO event
        (
   	 		owner_seq,
            event_seq,
            event_title,
            event_content,
            event_start,
            event_end,
            attach_path,
            attach_file,
            in_date,
            in_user_id,
            up_date,
            up_user_id
        )
        VALUES
        (
	        :1,
	        event_seq.nextval,
	        :2,
	        :3,
	        to_date(:4, 'YYYY-MM-DD'),
	        to_date(:5, 'YYYY-MM-DD') + 1 - 1/24/60/60,
            :6,
            :7,
	        to_char(sysdate, 'YYYYMMDD.HHMISS'),
	        :8,
	        to_char(sysdate, 'YYYYMMDD.HHMISS'),
            :9
        )
    </update>
    <update id="update">
        UPDATE
        	event
       	SET
	        event_title			=:1,
	        event_content		=:2,
	        event_start			=:3,
	        event_end			=:4,
            attach_path         =:5,
            attach_file         =:6,
	        up_date				=to_char(sysdate, 'YYYYMMDD.HHMISS'),
	        up_user_id			=:7
         WHERE
         	owner_seq=:8
         AND
            event_seq=:9
    </update>
    
    <update id="del_img">
        update
        	event
       	set
	        attach_path			= '',
	        attach_file			= '',
	        up_date				=to_char(sysdate, 'YYYYMMDD.HHMISS')
         where
         	owner_seq=:1
         and
            event_seq=:2

    </update>
    <update id="delete">
        delete from event
        where
            owner_seq=:1
        and
            event_seq=:2
        and
            to_char(sysdate,('YYYYMMDD')) > to_char(event_end,('YYYYMMDD'))
    </update>
</mapper>